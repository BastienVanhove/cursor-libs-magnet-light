var N=Object.create,f=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var b=t=>f(t,"__esModule",{value:!0});var E=(t,s)=>{for(var e in s)f(t,e,{get:s[e],enumerable:!0})},O=(t,s,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of h(s))!k.call(t,o)&&o!=="default"&&f(t,o,{get:()=>s[o],enumerable:!(e=d(s,o))||e.enumerable});return t},P=t=>O(b(f(t!=null?N(G(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);b(exports);E(exports,{atom:()=>I,default:()=>V});var i=P(require("../utils"));function I(t){const s=[];let e,o=!0,u;const a=this,F=()=>{s.forEach(n=>n(e))},p=()=>a?.onGet?a.onGet(u):(0,i.isSuspense)(e)?e.read():e,S=(n,l)=>{const T=!l?.noSuspense,y=l?.equal||Object.is,A=(r,c)=>{y(e,r)||(e=a?.beforeValueSet?.(u,r,o)||r,a?.afterValueSet?.(u,e,o),o=!1,c&&F())};if((0,i.isFunction)(n)){let r;if(l?.fromInit){const c=n;try{r=c(m=>(m.subscribe(()=>S(n,l)),m.get()))}catch(m){e=(0,i.suspensePromise)(m,()=>null);return}}else r=n(e);r instanceof Promise?e=(0,i.suspensePromise)(r,c=>{A(c,!0)}):A(r,!T)}else A(n,!T);T&&F()};return u={get:p,set:S,subscribe:n=>s.push(n),UNSAFE_directSet:n=>{e=n},UNSAFE_notify:F,UNSAFE_storage:new WeakMap},S(t,{fromInit:!0}),a?.onCreate?.(u)||u}var V=I;
